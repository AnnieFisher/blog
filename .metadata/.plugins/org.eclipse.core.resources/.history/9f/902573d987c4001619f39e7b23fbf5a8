var app = angular.module('ngBlog');
app.directive('blogDirective', function($location, postService, $compile){
	return{
		
		restrict : 'E',
		template :  
		
		`
			
        		<div class = "row">
	        		<div>
		        		<ul>
		        			
						<li><h3>{{blog.postName}}</h3></li>	
						<li><h5>{{blog.postDate}}</h5></li>	
						<li><h4>{{blog.body}}</h4></li>
						<button ng-click = "deletePost(blog)" >Delete Post</button>
						<button ng-click = "update(blog)" >Update Post</button>
		        		</ul>
	        		</div>
        		</div>
        
    
		
		`,
		
		link : function($scope, $element, $attr){
			
			
			$scope.blog = postService.getBlog();
			
		     $scope.blogCopy = {};
		     var editForm = null;

		     $scope.update = function(blog) {

		      if(editForm===null){
		        $scope.blogCopy = angular.copy(blog);

		    	var $inputRow =
					`<form class = "row">
					<input type = "text" ng-model ="blogCopy.postName" />
					<input type = "text" ng-model ="blogCopy.body" />
				
					<button class "btn btn-primary" ng-click="save(blogCopy)"> Save</button>
					<button ng-click="cancel()" >Cancel</button>
					<br><br><br>
					</form>`
		       var compiledForm = $compile($inputRow)($scope);
		       editForm = compiledForm;
		       $element.after(compiledForm);

		    }
		}
		$scope.cancel = function() {
		  if(editForm !=null) {
		    editForm.remove(editForm);
		    editForm = null;
		  }
		}
		$scope.save = function(blog){
		  $scope.edit(blog);
		  editForm.remove();
		  editForm = null;
		  $scope.blogCopy = {};
		}
			
			
			
		}
	}
	
});